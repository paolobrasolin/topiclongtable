\documentclass[full,kernel]{l3doc}

\usepackage{topiclongtable}

\begin{document}

\title{%
  The \pkg{topiclongtable} package%
  \thanks{Development of this package was sponsored by Human Predictions,
    LLC (\href{http://www.humanpredictions.com}{www.humanpredictions.com}).}\\
  Autocollapsing cells in longtables
}

\author{
  Paolo Brasolin\\
  \href{mailto:paolo.brasolin@gmail.com}{paolo.brasolin@gmail.com}
}

\date{2018/11/03 v1.2.1}

\maketitle

\begin{documentation}


This \LaTeX\ package extends \env{longtable}s implementing
\env{topiclongtable}s, in which vertically adjacent cells merge if and only if
\begin{itemize}
  \item they have the same content, and
  \item the cells on their left are merged.
\end{itemize}

Furthermore the merging is well behaved, in that
\begin{itemize}
  \item it does not happen after page breaks, and
  \item correct separation lines are drawn automatically.
\end{itemize}

The typical use case is a table that spans multiple pages and
contains a list of hierarchically organized topics (hence the package
name).




\section*{Usage}

To use the package install it in your tree (or put \file{topiclongtable.sty} in your work folder) and require it in your preamble:

\begin{verbatim}
  \usepackage{topiclongtable}
\end{verbatim}




\subsection*{Environment}

\begin{function}{topiclongtable}
  \begin{syntax}
    \tn[no-index]{begin}\{\env{topiclongtable}\}\marg{column specification}
    \ \ \meta{cells specification}
    \tn[no-index]{end}\{\env{topiclongtable}\}
  \end{syntax}
  The \env{topiclongtable} environment extends \env{longtable}.
  They share the same syntax and all features of the latter are
  available in the former.

  To use \pkg{topiclongtable} macros you must \emph{prepend} \enquote{\texttt{F}}
  to the first column specification and \enquote{\texttt{T}} to all others.  You
  can omit the prefix only on columns following the last one that contains
  \pkg{topiclongtable} macros:
  \begin{verbatim}
    \begin{topiclongtable}{|Fl|Tl|Tl|Tr|l|r}
      % ...
    \end{topiclongtable}
  \end{verbatim}
\end{function}\smallskip




\subsection*{Macros}

\begin{function}{\Topic}
  \begin{syntax}
    \tn{Topic}\oarg{content}
  \end{syntax}
  This is the main macro of the package; you can use it to wrap the
  optional \meta{content} of a cell in order to allow it to merge with
  adjacent cells.
\end{function}\smallskip

The behaviour of \tn{Topic} can be observed in the following kitchen sink:
\begin{verbatim}
  \begin{topiclongtable}{|Fl|Tl|Tl|l|}
    \Topic[Topic 1] & \Topic[Subtopic 1] & \Topic[Subsubtopic 1] & Foo \\
    \Topic          & \Topic             & \Topic[Subsubtopic 2] & Bar \\ 
    \Topic          & \Topic[Subtopic 1] & \Topic[Subsubtopic 2] & Baz \\ 
    \Topic[Topic 2] & \Topic[Subtopic 1] & \Topic[Subsubtopic 3] & Qux \\ 
    \Topic          & \Topic[Subtopic 2] & \Topic[Subsubtopic 4] & Zod \\ 
    \Topic          & \Topic             & \Topic                & Bop \\
  \end{topiclongtable}
\end{verbatim}
\begin{topiclongtable}{|Fl|Tl|Tl|l|}
  \Topic[Topic 1] & \Topic[Subtopic 1] & \Topic[Subsubtopic 1] & Foo \\
  \Topic          & \Topic             & \Topic[Subsubtopic 2] & Bar \\ 
  \Topic          & \Topic[Subtopic 1] & \Topic[Subsubtopic 2] & Baz \\ 
  \Topic[Topic 2] & \Topic[Subtopic 1] & \Topic[Subsubtopic 3] & Qux \\
  \Topic          & \Topic[Subtopic 2] & \Topic[Subsubtopic 4] & Zod \\ 
  \Topic          & \Topic             & \Topic                & Bop \\
\end{topiclongtable}

Here is a breakdown of the manifested behaviour:
\begin{itemize}[nosep]
  \item the parameter is optional;
  \item merging happens when it is omitted (rows 1--3 on column 1);
  \item merging happens when its value is equal to the one above
  (rows 2--3 on columns 2 and 3);
  \item merging does not happen (rows 3--4 on column 2) when the
  cells on the left are not merged (rows 3--4 on column 1).
\end{itemize}

\begin{function}{\TopicLine}
  \begin{syntax}
    \tn{TopicLine}
  \end{syntax}
  \tn{TopicLine} can be used at the start of a row to automatically
  draw the horizontal lines that separates it from the row above
  and correctly accounts for merged cells.

  By default no horizontal lines are drawn on top and bottom of
  table chunks to allow for maximal flexibility. You can use longtable
  footer and headers to easily draw them (or whichever footer/header
  you may desire) as shown in the next example.
\end{function}\smallskip

Here is the previous kitchen sink with lines added:
\begin{verbatim}
  \begin{topiclongtable}{|Fl|Tl|Tl|l|}
    \hline\endhead
    \hline\endfoot
    \TopicLine \Topic[T1] & \Topic[ST1] & \Topic[SST1] & Foo \\
    \TopicLine \Topic     & \Topic      & \Topic[SST2] & Bar \\ 
    \TopicLine \Topic     & \Topic[ST1] & \Topic[SST2] & Baz \\ 
    \TopicLine \Topic[T2] & \Topic[ST1] & \Topic[SST3] & Qux \\ 
    \TopicLine \Topic     & \Topic[ST2] & \Topic[SST4] & Zod \\ 
    \TopicLine \Topic     & \Topic      & \Topic       & Bop \\
  \end{topiclongtable}
\end{verbatim}
\begin{topiclongtable}{|Fl|Tl|Tl|l|}
  \hline\endhead
  \hline\endfoot
  \TopicLine \Topic[T1] & \Topic[ST1] & \Topic[SST1] & Foo \\
  \TopicLine \Topic     & \Topic      & \Topic[SST2] & Bar \\ 
  \TopicLine \Topic     & \Topic[ST1] & \Topic[SST2] & Baz \\ 
  \TopicLine \Topic[T2] & \Topic[ST1] & \Topic[SST3] & Qux \\ 
  \TopicLine \Topic     & \Topic[ST2] & \Topic[SST4] & Zod \\ 
  \TopicLine \Topic     & \Topic      & \Topic       & Bop \\
\end{topiclongtable}




\subsection*{Settings}

All settings described in this section are global and can be changed between tables.

\begin{function}{\TopicSetContinuationCode}
  \begin{syntax}
    \tn{TopicSetContinuationCode}\marg{\TeX\ code}
  \end{syntax}
  Cells \emph{continuing} from the previous page can be explicitly
  marked.  You can set a code fragment to append to such cells using
  \tn{TopicSetContinuationCode}:
  \begin{verbatim}
    \TopicSetContinuationCode{\ (cont.)}
  \end{verbatim}
  By default no mark is appended and you can reset to the default
  using
  \begin{verbatim}
     \TopicSetContinuationCode{}
  \end{verbatim}
\end{function}\smallskip

\begin{function}{\TopicSetVPos}
  \begin{syntax}
    \tn{TopicSetVPos}\marg{vertical position specification}
  \end{syntax}
  You can set the vertical position for \tn{Topic} cells by using
  \tn{TopicSetVPos}.  Allowed \meta{vertical position specification}s
  are \enquote{\texttt{b}} (bottom), \enquote{\texttt{c}} (center)
  and the default \enquote{\texttt{t}} (top).
\end{function}\smallskip

\begin{function}{\TopicSetWidth}
  \begin{syntax}
    \tn{TopicSetVPos}\marg{cell width specification}
  \end{syntax}
  You can set the width of the \tn{Topic} cells by using
  \tn{TopicSetWidth}.  Allowed \meta{cell width specification}s are
  \enquote{\texttt{=}} (fit column width) and the default
  \enquote{\texttt{*}} (fit natural content width).
\end{function}\smallskip

\end{documentation}

\PrintIndex

\end{document}
